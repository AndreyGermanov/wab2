<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head>

<meta content="text/html; charset=UTF-8" http-equiv="content-type" /><title>quotas.html</title></head><body>
<h1>Квотирование дискового пространства и количества файлов</h1>
<br />
<div style="text-align: justify;">Файловый сервер позволяет установить
квоты на количество файлов, которые каждый пользователь или группа
могут создать на диске данных сервера, а также, на объем дискового
пространства, которое их файлы могут занимать.<br />
</div>
<br />
<div style="text-align: justify;">Квота это лимит, ограничивающий
использование определенного ресурса. Бывает два типа лимитов: мягкий
лимит и жесткий лимит. Если пользователь превышает установленный для
него мягкий лимит, то подсистема квотирования оповещает об этом и
устанавливает временной период (<span style="font-weight: bold;">Grace time</span>),
в течении которого пользователь должен "исправиться", то есть
освободить дисковое пространство, удалив часть своих данных. Если
пользователь за это время (по умолчанию 7 дней) не удалил свои данные, то мягкий лимит превращается в жесткий.<br />
</div>
<br />
<div style="text-align: justify;">Жесткий лимит пользователь не может
превысить. Сервер блокирует любые попытки записать данные сверх
жесткого лимита. При таких попытках пользователь будет получать
сообщение "<span style="font-style: italic;">Недостаточно свободного места на диске</span>".<br />
</div>
<br />
<div style="text-align: justify;">Как правило мягкий лимит
устанавливается несколько меньше, чем жесткий. Лимиты можно
устанавливать как на пользователя, так и на группу пользователей. Лимит
для группы ограничивает дисковое пространство, которое могут
использовать все пользователи группы в совокупности.<br />
</div>
<br />
<h2><a name="p1" /></h2>
<h2><a name="p1">Интерфейс модуля управления квотами</a></h2>
<div style="text-align: justify;"><a name="p1">Для управления квотами на сервере
используется уже знакомый нам из прошлого раздела Web-интерфейс Webmin.
Нужно войти в Webmin и найти модуль, который называется "<span style="font-weight: bold;">Дисковые квоты</span>". Он находится в разделе "<span style="font-weight: bold;">Система</span>".<br />
</a></div>
<a name="p1"><br />
</a><div style="text-align: center;"><a name="p1"><img src="img/diskquotasicon.png" alt="diskquotasicon.png" /><br />
</a></div>
<a name="p1"><br />
<br />
</a><div style="text-align: justify;"><a name="p1">При входе в этот раздел, появляется основной интерфейс модуля управления квотами:<br />
</a></div>
<a name="p1"><br />
<img style="width: 918px; height: 291px;" src="img/quotasmainwindow.png" alt="quotasmainwindow.png" /><br />
<br />
</a><div style="text-align: justify;"><a name="p1">В таблице перечислены разделы
жесткого диска, для которых включено управление квотами. В данном
случае такой раздел один, это раздел <span style="font-style: italic;">/data</span>,
в котором находятся общие папки сервера. Если управление квотами не
используется, можно отключить квотирование на этом разделе, нажав
гиперссылку "<span style="font-weight: bold;">Отключить квоты</span>" в колонке "<span style="font-weight: bold;">Действие</span>".<br />
</a></div>
<a name="p1"><br />
</a><div style="text-align: justify;"><a name="p1">Как ранее говорилось, квоты можно
устанавливать либо пользователям, либо группам. Чтобы посмотреть все
установленные квоты пользователей и информацию о том, как они их
используют, нажмите гиперссылку<span style="font-weight: bold;"> /data(users)</span> в колонке "<span style="font-weight: bold;">Файловая система</span>". Чтобы посмотреть установленные квоты групп, нажмите гиперссылку <span style="font-weight: bold;">/data(groups)</span>. В режиме просмотра квот их можно изменять.<br />
</a></div>
<a name="p1"><br />
</a><div style="text-align: justify;"><a name="p1">Также можно изменить квоты с помощью
кнопок и полей ввода, которые находятся под таблицей. Чтобы изменить
квоты пользователя, нужно указать его имя в верхнем поле ввода и нажать
кнопку "<span style="font-weight: bold;">Изменить квоты пользователей</span>". Чтобы изменить квоты группы, нужно указать ее имя в нижнем поле ввода и нажать кнопку "<span style="font-weight: bold;">Изменить квоты дисков</span>".<br />
</a><h2><a name="p2">Работа с квотами пользователя</a></h2>
<a name="p2"><br />
</a><h3><a name="p3">Изменение квот пользователя</a></h3>
<a name="p3">Форма изменения квот пользователя позволяет изменить жесткие и мягкие
лимиты на используемое дисковое пространство и на количество файлов,
которые пользователь может создать на разделе жесткого диска.<br />
<br />
</a><div style="text-align: center;"><a name="p3"><img src="img/setquotawindow.png" alt="setquotawindow.png" /><br />
</a></div>
<a name="p3"><br />
В поле "<span style="font-weight: bold;">Soft kilobyte limit</span>"
указывается мягкий лимит дискового пространства, которое данный
пользователь может использовать в указанной единице измерения (kB, MB,
GB). Чтобы убрать лимит, включите переключатель "<span style="font-weight: bold;">Не ограничено</span>". Ниже указано пространство на диске, которое пользователь занимает в данный момент (1.57 MB). <br />
<br />
По аналогии заполняются остальные поля в этой форме.<br />
<br />
В поле "<span style="font-weight: bold;">Hard kilobyte limit</span>" указывается жесткий лимит дискового пространства, которое данный пользователь может использовать.<br />
<br />
В поле "<span style="font-weight: bold;">Лимит файлов</span>" указывается мягкий лимит на количество файлов, которые пользователь может создать. <br />
<br />
В поле "<span style="font-weight: bold;">Строгий лимит</span>" указывается жесткий лимит на количество файлов, которые пользователь может создать.<br />
<br />
После ввода данных нужно нажать кнопку "<span style="font-weight: bold;">Обновить</span>", после чего лимиты сразу же начнут работать.<br />
<br />
</a><h3><a name="p4">Работа со списком квот пользователей</a></h3>
<a name="p4"><br />
Если на основном экране модуля управления квотами нажать гиперссылку <span style="font-weight: bold;">/data (users)</span>, появится список квот, которые действуют в данный момент для всех пользователей.<br />
<br />
<br />
<img src="img/userquotalist.png" alt="userquotalist.png" /><br />
<br />
В первой колонке указываются пользователи. Следующие колонки сгруппированы в две группы: квоты на дисковое пространство (<span style="font-weight: bold;">Disk space</span>) и квоты на количество файлов (<span style="font-weight: bold;">Файлы</span>).<br />
<br />
Для каждого пользователя показано, какое количество ресурса он использует (колонка "<span style="font-weight: bold;">Использовано</span>"), мягкий лимит на ресурс (колонка "<span style="font-weight: bold;">Лимит</span>") и жесткий лимит на ресурс (колонка "<span style="font-weight: bold;">Строгий лимит</span>").
Например, пользователь andrey использует 1.57 Мб дискового
пространства, для него установлен мягкий лимит в 3 Мб и жесткий лимит в
4 Мб. Если он превысит мягкий лимит, то таблица примет следующий вид:<br />
<br />
</a><div style="text-align: center;"><a name="p4"><img src="img/softlimit.png" alt="softlimit.png" /><br />
</a></div>
<a name="p4"><br />
</a><div style="text-align: justify;"><a name="p4">Здесь видно, что количество
использованного пространства выделено оранжевым цветом и это число
больше мягкого лимита. Также, здесь видно что в колонке "<span style="font-weight: bold;">Grace</span>" появилось "<span style="font-style: italic;">6days</span>".
В этой колонке отображается время, которое дается пользователю чтобы
"исправиться", то есть убрать часть данных. Это время можно изменить,
нажав гиперссылку "<span style="font-weight: bold;">Изменить время отсрочки</span>"
над таблицей. Можно изменить время отсрочки для всех пользователей,
либо для конкретных, включив флажки этих пользователей в самой левой
колонке таблицы. В течении этого временного периода система&nbsp;
квотирования может отправлять пользователю по электронной почте
предупреждения о том, что его время скоро кончится. Эту функцию можно
включить и настроить на закладке "<span style="font-weight: bold;">E-Mail notifications</span>",
которая находится над таблицей. Если пользователь не исправился в
течении данного ему периода, то мягкий лимит становится жестким (в
данном случае это значит что в колонке "Строгий лимит" будет 3 MB) и
этот лимит пользователь уже никогда не сможет превысить, даже на
некоторое время. Пользователю придется просить системного
администратора, чтобы он изменил его жесткий лимит обратно. Если
пользователь каким-то образом превысил жесткий лимит или подошел к
нему, то количество используемого им дискового пространства будет
отображаться красным цветом.<br />
</a></div>
<a name="p4"><br />
</a><div style="text-align: justify;"><a name="p4">Кроме просмотра лимитов, с помощью этой таблицы можно выполнять ряд других действий. <br />
</a></div>
<ul style="text-align: justify;">
<a name="p4">  </a><li><a name="p4">Можно изменить лимиты пользователя, нажав по его имени левой кнопкой мыши.</a></li>
<a name="p4">  </a><li><a name="p4">Можно изменить лимиты сразу нескольким пользователям, включив флажки напротив их имен и нажав кнопку "<span style="font-weight: bold;">Update Selected Users</span>" внизу, под таблицей.</a></li>
<a name="p4">  </a><li><a name="p4">Можно запустить внеплановую проверку квот для всех пользователей или для выделенных, нажав гиперссылку "<span style="font-weight: bold;">Проверить квоты</span>" над таблицей (или под таблицей).</a></li>
</ul>
<div style="text-align: justify;">
<h3><a name="p5">Параметры оповещения о превышении лимита</a></h3>
</div>
<a name="p5"><br />
</a><div style="text-align: justify;"><a name="p5">На закладке "<span style="font-weight: bold;">Email notifications</span>"
настраивается, будут ли пользователи получать оповещения в случае
превышения ими мягких лимитов на объем дискового пространства и на
количество файлов.<br />
</a></div>
<a name="p5"><br />
</a><div style="text-align: center;"><a name="p5"><img src="img/limitemailnotify.png" alt="limitemailnotify.png" /><br />
</a></div>
<a name="p5"><br />
</a><div style="text-align: justify;"><span style="font-weight: bold;"><a name="p5">Send email to users ? -</a></span><a name="p5"> отправлять почтовые сообщения пользователям или нет.<br />
</a></div>
<a name="p5"><br />
</a><div style="text-align: justify;"><span style="font-weight: bold;"><a name="p5">Limit type</a></span><a name="p5"> - по поводу превышения каких лимитов отправлять сообщения - "<span style="font-weight: bold;">Строгий лимит</span>" или "<span style="font-weight: bold;">Лимит</span>" (мягкий лимит). <br />
</a></div>
<a name="p5"><br />
</a><div style="text-align: justify;"><span style="font-weight: bold;"><a name="p5">Domain for user addresses</a></span><a name="p5"> - в каком домене находятся почтовые ящики пользователей, на которые будут отправляться письма. Если указано "<span style="font-style: italic;">localhost</span>", то письма будут отправляться по адресам <span style="font-style: italic;">&lt;имя-пользователя&gt;@localhost</span>, что означает - отправлять письма в локальные почтовые ящики пользователей на этом сервере, которые находятся в папке <span style="font-style: italic;">/var/spool/mail</span>
. Здесь также можно указать другое имя домена. В этом случае нужно
позаботится о том, чтобы письма доходили до этого домена и принимались
на нем, то есть, DNS-сервер, к которому обращается файловый сервер для
разрешения имен должен находить MX-запись для этого домена и получать
по этой MX-записи IP-адрес SMTP-сервера, который получает почту этого
домена. Этот SMTP-сервер должен быть настроен так, чтобы принимать
почту, которая отправляется по адресам
&lt;имя-пользователя&gt;@&lt;имя-домена&gt; с файлового сервера. На нем
должны быть заведены почтовые ящики всех пользователей, для которых
установлены квоты и он не должен блокировать почту, идущую с файлового
сервера по этим адресам.<br />
</a></div>
<a name="p5"><br />
</a><div style="text-align: justify;"><a name="p5">Если у вас в локальной сети есть почтовый сервер Mystix Collector MX и настроена интеграция с ним (см. "</a><a onclick='parent.obj.go_to("4.3",true,event);' href="null">Интеграция с другими серверами</a>"),
то почтовые ящики для всех пользователей домена создаются на нем
автоматически при создании самих пользователей и почтовый сервер будет
принимать почту от файлового сервера.<br />
</div>
<br />
<span style="font-weight: bold;">Also Cc: email to</span> - посылать также копию всех писем по указанному адресу.<br />
<br />
<span style="font-weight: bold;">Interval between messages</span> - с какой периодичностью отправлять сообщения о превышении лимита (в часах).<br />
<br />
<span style="font-weight: bold;">Warn when usage reaches %</span> - также предупреждать если процент использования ресурса превышает указанный.<br />
<br />
<span style="font-weight: bold;">From: address for email</span> - какой адрес отправителя указывать в письмах.<br />
<br />
<h2><a name="p6">Работа с квотами группы пользователей</a></h2>
<a name="p6"><br />
Квота группы это максимальное количество ресурса (дискового
пространства или количества файлов), которое могут использовать все
пользователи этой группы в совокупности. Поэтому один пользователь
может своими необдуманными действиями лишить всех остальных возможности
хранить данные на сервере. Нужно иметь это в виду при принятии решения,
в частности о том, каких пользователей можно объединять в одну группу.<br />
<br />
Для того чтобы войти в список квот групп, нужно нажать гиперссылку <span style="font-weight: bold;">/data (groups)</span> на главном экране модуля управления квотами.<br />
<br />
<br />
Работа с квотами групп производится по тем же правилам, что и работа с
квотами пользователей, поэтому здесь мы перечислим лишь отличия,
которые есть в интерфейсе. Все остальное вы можете найти выше в этом
разделе, при описании работы с квотами пользователя. <br />
<br />
Нет никаких отличий ни в форме изменения квот, ни в списке квот.
Отличие есть только в форме настройки оповещений о превышении лимитов
(Email notifications). Почтовые сообщения отправляются не каждому
пользователю группы, а лишь на один почтовый ящик - почтовый ящик
группы (если такой существует). Поэтому поле Domain for user addresses
было заменено на <span style="font-weight: bold;">Email destination:</span>&nbsp; в котором можно выбрать одно из двух значений:<br />
<br />
</a><ul>
<a name="p6">  </a><li><span style="font-weight: bold;"><a name="p6">Mailbox with same name as group</a></span><a name="p6"> - почтовый ящик, который называется как группа</a></li>
<a name="p6">  </a><li><span style="font-weight: bold;"><a name="p6">Address</a></span><a name="p6"> - указанный адрес</a></li>
</ul>
<a name="p6">Остальные параметры оповещений такие же, как в форме для пользователя.<br />
<br />
<br />
<br />
<br />
<br />
<br />
</a></div>
</body></html>